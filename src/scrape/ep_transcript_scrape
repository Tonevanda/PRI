import os
import re
import pandas as pd

def scrape_ass_files():
    subtitles_list = []
    directory = "full_ep_transcripts"
    if not os.path.exists(directory):
        print(f"Directory '{directory}' does not exist.")
        return {}
    counter = 1
    for filename in os.listdir(directory):
        if filename.endswith(".ass"):
            with open(os.path.join(directory, filename), 'r', encoding='utf-8') as file:
                content = file.read()
                dialogues = re.findall(r"Dialogue:.*?,.*?,.*?,.*?,.*?,.*?,.*?,.*?,.*?,(.*)", content)
                cleaned_dialogues = [re.sub(r"{.*?}", "", dialogue).replace("\\N", " ") for dialogue in dialogues]  # Remove formatting tags and "\N"
                cleaned_dialogues = [re.sub(r"\.\.\.", " ", dialogue) for dialogue in cleaned_dialogues]
                subtitles_list.append(" ".join(cleaned_dialogues)) # Join dialogues into a single string
            counter +=1
    #loop from 932 to 1121 this will be removed later
    for i in range(932,1121):
        subtitles_list.append("not yet done")
    return subtitles_list

if __name__ == "__main__":
    # Read the existing CSV file
    csv_file = "data.csv"
    df = pd.read_csv(csv_file)

    # Scrape subtitles
    subtitles_list = scrape_ass_files()

    df["episode script"] = subtitles_list

    # Write the updated DataFrame to a new CSV file
    updated_csv_file = "updated_data.csv"
    df.to_csv(updated_csv_file, index=False)

    print(f"Subtitles added and saved to {updated_csv_file}")
    